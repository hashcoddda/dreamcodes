<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موبائل نمبر اور شناختی کارڈ سرچ</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&family=Noto+Naskh+Arabic&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom Fonts */
        @font-face {
          font-family: "Jameel Noori Nastaleeq";
          src: url("/fonts/JameelNoori.woff2") format("woff2"),
               url("/fonts/JameelNoori.ttf") format("truetype");
          font-weight: normal;
          font-style: normal;
          font-display: swap;
        }

        :root {
          --primary-color: #3498db;
          --primary-dark: #2980b9;
          --success-color: #27ae60;
          --danger-color: #e74c3c;
          --text-color: #333;
          --light-bg: #f5f7fa;
          --card-bg: #ffffff;
          --border-radius: 12px;
          --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        * {
          box-sizing: border-box;
        }

        body {
          font-family: "Noto Nastaliq Urdu", "Noto Naskh Arabic",
                       "Jameel Noori Nastaleeq", "Segoe UI", system-ui, -apple-system, sans-serif;
          background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
          color: var(--text-color);
          line-height: 1.6;
          padding: 15px;
          min-height: 100vh;
          margin: 0;
        }

        .container {
          max-width: 100%;
          margin: 0 auto;
          background: var(--card-bg);
          border-radius: var(--border-radius);
          box-shadow: var(--box-shadow);
          padding: 20px;
          position: relative;
          overflow: hidden;
        }

        .container::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 5px;
          background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
        }

        h1 {
          text-align: center;
          color: #2c3e50;
          margin-bottom: 20px;
          font-weight: 600;
          position: relative;
          padding-bottom: 15px;
          font-size: 1.5rem;
        }

        h1::after {
          content: '';
          position: absolute;
          bottom: 0;
          right: 50%;
          transform: translateX(50%);
          width: 80px;
          height: 3px;
          background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
          border-radius: 3px;
        }

        .search-form {
          display: flex;
          flex-direction: column;
          margin-bottom: 20px;
          gap: 15px;
          background: #f8f9fa;
          padding: 15px;
          border-radius: 8px;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .input-group {
          display: flex;
          flex-direction: column;
          margin-bottom: 0;
        }

        .input-label {
          margin-bottom: 8px;
          font-weight: 600;
          color: #2c3e50;
          font-size: 0.9rem;
        }

        .search-input {
          width: 100%;
          padding: 12px 15px;
          border: 1px solid #ddd;
          border-radius: 6px;
          font-size: 16px;
          transition: all 0.3s;
          text-align: right;
        }

        .search-input:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .search-btn {
          background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
          color: white;
          border: none;
          border-radius: 6px;
          padding: 12px 20px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
          box-shadow: 0 2px 5px rgba(52, 152, 219, 0.3);
          width: 100%;
        }

        .search-btn:hover {
          background: linear-gradient(to right, var(--primary-dark), #2573a7);
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(52, 152, 219, 0.4);
        }

        .search-btn:active {
          transform: translateY(0);
        }

        .results-container {
          margin-top: 20px;
          overflow-x: auto;
          border-radius: 8px;
        }

        .cards-container {
          display: flex;
          flex-direction: column;
          gap: 15px;
          margin-top: 15px;
        }

        .result-card {
          border: 1px solid #e1e1e1;
          border-radius: 8px;
          padding: 15px;
          background: white;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
          transition: all 0.3s;
        }

        .result-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .result-card.positive {
          border-left: 4px solid var(--success-color);
        }

        .result-card.negative {
          border-left: 4px solid var(--danger-color);
        }

        .card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
          padding-bottom: 10px;
          border-bottom: 1px solid #eee;
        }

        .card-title {
          font-weight: 600;
          color: #2c3e50;
          margin: 0;
          font-size: 1.1rem;
        }

        .status-badge {
          padding: 5px 10px;
          border-radius: 20px;
          font-size: 12px;
          font-weight: 600;
        }

        .status-positive {
          background-color: #d5f4e6;
          color: var(--success-color);
        }

        .status-negative {
          background-color: #fdeaea;
          color: var(--danger-color);
        }

        .card-body {
          color: #555;
        }

        .card-row {
          display: flex;
          flex-direction: column;
          margin-bottom: 10px;
          padding-bottom: 10px;
          border-bottom: 1px solid #f5f5f5;
        }

        .card-label {
          font-weight: 600;
          color: #2c3e50;
          margin-bottom: 5px;
        }

        .card-value {
          color: #555;
          line-height: 1.5;
        }

        .no-results {
          text-align: center;
          padding: 20px;
          color: #7f8c8d;
          font-style: italic;
          background: #f8f9fa;
          border-radius: 8px;
        }

        .error-message {
          color: var(--danger-color);
          margin-top: 10px;
          padding: 12px;
          background-color: #fdf2f2;
          border-radius: 6px;
          display: none;
          border-right: 4px solid var(--danger-color);
          text-align: right;
        }

        .loading {
          display: none;
          text-align: center;
          padding: 20px;
        }

        .spinner {
          border: 4px solid rgba(52, 152, 219, 0.2);
          border-radius: 50%;
          border-top: 4px solid var(--primary-color);
          width: 40px;
          height: 40px;
          animation: spin 1s linear infinite;
          margin: 0 auto 15px;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .instructions {
          background: #e8f4fc;
          padding: 12px;
          border-radius: 8px;
          margin-bottom: 15px;
          border-right: 4px solid var(--primary-color);
          text-align: right;
          font-size: 0.9rem;
        }

        .contact-info {
          text-align: center;
          margin-top: 20px;
          padding: 15px;
          background: #f8f9fa;
          border-radius: 8px;
          font-size: 0.85rem;
        }

        /* Tablet and Desktop Styles */
        @media (min-width: 768px) {
          .container {
            max-width: 90%;
            padding: 25px;
          }

          h1 {
            font-size: 1.8rem;
          }

          .search-form {
            flex-direction: row;
            align-items: flex-end;
          }

          .input-group {
            flex: 1;
            margin-bottom: 0;
          }

          .search-btn {
            width: auto;
          }

          .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
          }

          .card-row {
            flex-direction: row;
            justify-content: space-between;
          }

          .card-label {
            margin-bottom: 0;
          }
        }

        @media (min-width: 992px) {
          .container {
            max-width: 1200px;
            padding: 30px;
          }

          h1 {
            font-size: 2rem;
          }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>موبائل نمبر اور شناختی کارڈ سرچ</h1>

    <form class="search-form" id="searchForm">
        <div class="input-group">
            <label class="input-label" for="searchInput">موبائل نمبر یا شناختی کارڈ نمبر:</label>
            <input
                    type="number"
                    class="search-input"
                    id="searchInput"
                    placeholder="10 سے 13 ہندسوں پر مشتمل نمبر درج کریں"
                    required
            >
        </div>
        <button type="submit" class="search-btn">سرچ کریں</button>
    </form>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>ڈیٹا بیس میں تلاش کی جا رہی ہے، براہ کرم انتظار کریں...</p>
    </div>

    <div class="error-message" id="errorMessage"></div>

    <div class="results-container" id="resultsContainer">
        <!-- نتائج یہاں کارڈز کی شکل میں ظاہر ہوں گے -->
    </div>

    <div class="contact-info">
        <p>اگر آپ کو کوئی مسئلہ درپیش ہو تو براہ کرم ہم سے رابطہ کریں</br>XXعدیلXX</p>
    </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.getElementById('searchForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const searchInput = document.getElementById('searchInput').value.trim();
        const errorMessage = document.getElementById('errorMessage');
        const resultsContainer = document.getElementById('resultsContainer');
        const loading = document.getElementById('loading');

        // Clear previous results and errors
        errorMessage.style.display = 'none';
        resultsContainer.innerHTML = '';

        // Validate input - accept any number between 10-13 digits
        const numberRegex = /^\d{10,13}$/;

        if (!numberRegex.test(searchInput)) {
            errorMessage.textContent = 'براہ کرم 10 سے 13 ہندسوں پر مشتمل نمبر درج کریں یا ہم سے رابطہ کریں!';
            errorMessage.style.display = 'block';
            return;
        }

        // Show loading indicator
        loading.style.display = 'block';

        try {
            // Search both APIs simultaneously
            const [site1Results, site2Results] = await Promise.all([
                searchSite1(searchInput),
                searchSite2(searchInput)
            ]);

            // Hide loading indicator
            loading.style.display = 'none';

            // Display results in cards
            displayResults(site1Results, site2Results, searchInput);

        } catch (error) {
            loading.style.display = 'none';
            errorMessage.textContent = `ڈیٹا حاصل کرنے میں خرابی: ${error.message}`;
            errorMessage.style.display = 'block';
            console.error('Error:', error);
        }
    });

    // Search first site (mobile number search)
    async function searchSite1(searchInput) {
        try {
            const response = await fetch(`https://simsownerdetails.com/wp-content/plugins/livetrackers-plugin-old-working/search.php?type=mobile&search=${searchInput}`);

            if (!response.ok) {
                throw new Error(`API request failed with status ${response.status}`);
            }

            const html = await response.text();

            // Parse the HTML response and extract data
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const rows = doc.querySelectorAll('tbody tr');

            if (rows.length === 0) {
                return { success: false, data: [] };
            }

            const results = [];
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const number = cells[0]?.textContent || '-';
                const name = cells[1]?.textContent || '-';
                const cnic = cells[2]?.textContent || '-';
                const address = cells[3]?.textContent || '-';

                results.push({
                    number,
                    name,
                    cnic,
                    address
                });
            });

            return { success: true, data: results };
        } catch (error) {
            console.error('Error searching site 1:', error);
            return { success: false, error: error.message, data: [] };
        }
    }

    // Search second site (CNIC search)
    async function searchSite2(searchInput) {
        try {
            // Only search if input is exactly 13 digits (CNIC format)
            if (searchInput.length !== 13) {
                return { success: false, data: [], message: "CNIC must be exactly 13 digits" };
            }

            const response = await $.ajax({
                url: "https://ccms.pitc.com.pk/api/search",
                method: "POST",
                data: { cnic: searchInput }
            });

            if (!response.data || response.data.length === 0) {
                return { success: false, data: [] };
            }

            // Fetch additional details for each result
            const detailedResults = await Promise.all(
                response.data.map(async (item) => {
                    if (item.REFNO) {
                        try {
                            const detailResponse = await $.ajax({
                                url: `https://ccms.pitc.com.pk/api/details/user?reference=${item.REFNO}`,
                                method: "GET"
                            });

                            if (detailResponse && detailResponse.user) {
                                return {
                                    ...item,
                                    ADDR1: detailResponse.user.ADDR1,
                                    CONTACTNO: detailResponse.user.CONTACTNO
                                };
                            }
                        } catch (error) {
                            console.error(`Error fetching details for REFNO ${item.REFNO}:`, error);
                        }
                    }
                    return item;
                })
            );

            return { success: true, data: detailedResults };
        } catch (error) {
            console.error('Error searching site 2:', error);
            return { success: false, error: error.message, data: [] };
        }
    }

    function displayResults(site1Results, site2Results, searchInput) {
        const resultsContainer = document.getElementById('resultsContainer');

        // Create cards container
        const cardsContainer = document.createElement('div');
        cardsContainer.className = 'cards-container';

        // Site 1 Results Card
        const site1Card = createResultCard(
            'موبائل نمبر سرچ',
            site1Results.success,
            site1Results.data,
            searchInput,
            'site1'
        );
        cardsContainer.appendChild(site1Card);

        // Site 2 Results Card
        const site2Card = createResultCard(
            'شناختی کارڈ سرچ',
            site2Results.success,
            site2Results.data,
            searchInput,
            'site2'
        );
        cardsContainer.appendChild(site2Card);

        resultsContainer.appendChild(cardsContainer);
    }

    function createResultCard(title, success, data, searchInput, siteType) {
        const card = document.createElement('div');
        card.className = `result-card ${success ? 'positive' : 'negative'}`;

        const cardHeader = document.createElement('div');
        cardHeader.className = 'card-header';

        const cardTitle = document.createElement('h3');
        cardTitle.className = 'card-title';
        cardTitle.textContent = title;

        const statusBadge = document.createElement('span');
        statusBadge.className = `status-badge ${success ? 'status-positive' : 'status-negative'}`;
        statusBadge.textContent = success ? 'موجود ہے' : 'موجود نہیں';

        cardHeader.appendChild(cardTitle);
        cardHeader.appendChild(statusBadge);

        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';

        if (success && data.length > 0) {
            if (siteType === 'site1') {
                // Display mobile number search results
                data.forEach((item, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'card-row';

                    const resultNumber = document.createElement('div');
                    resultNumber.className = 'card-label';
                    resultNumber.textContent = `نتیجہ ${index + 1}`;

                    const resultDetails = document.createElement('div');
                    resultDetails.className = 'card-value';
                    resultDetails.innerHTML = `
                        <div><strong>نام:</strong> ${item.name}</div>
                        <div><strong>شناختی کارڈ:</strong> ${item.cnic}</div>
                        <div><strong>موبائل نمبر:</strong> ${item.number}</div>
                        <div><strong>پتہ:</strong> ${item.address}</div>
                    `;

                    resultItem.appendChild(resultNumber);
                    resultItem.appendChild(resultDetails);
                    cardBody.appendChild(resultItem);
                });
            } else {
                // Display CNIC search results
                data.forEach((item, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'card-row';

                    const resultNumber = document.createElement('div');
                    resultNumber.className = 'card-label';
                    resultNumber.textContent = `نتیجہ ${index + 1}`;

                    const resultDetails = document.createElement('div');
                    resultDetails.className = 'card-value';

                    let detailsHTML = `
                        <div><strong>نام:</strong> ${item.NAME || 'نامعلوم'}</div>
                      <!--  <div><strong>حوالہ نمبر:</strong> ${item.REFNO || 'نامعلوم'}</div>  -->
                        <div><strong>شناختی کارڈ:</strong> ${searchInput}</div>
                    `;

                    // Add ADDR1 and CONTACTNO if available
                    if (item.ADDR1) {
                        detailsHTML += `<div><strong>پتہ:</strong> ${item.ADDR1}</div>`;
                    }

                    if (item.CONTACTNO) {
                        detailsHTML += `<div><strong>رابطہ نمبر:</strong> ${item.CONTACTNO}</div>`;
                    }

                    resultDetails.innerHTML = detailsHTML;

                    resultItem.appendChild(resultNumber);
                    resultItem.appendChild(resultDetails);
                    cardBody.appendChild(resultItem);
                });
            }
        } else {
            const noResults = document.createElement('div');
            noResults.className = 'no-results';
            noResults.textContent = 'اس سرچ کے لیے کوئی نتائج نہیں ملے';
            cardBody.appendChild(noResults);
        }

        card.appendChild(cardHeader);
        card.appendChild(cardBody);

        return card;
    }
</script>
</body>
</html>
