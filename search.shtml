<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موبائل نمبر اور شناختی کارڈ سرچ</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&family=Noto+Naskh+Arabic&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom Fonts */
        @font-face {
          font-family: "Jameel Noori Nastaleeq";
          src: url("/fonts/JameelNoori.woff2") format("woff2"),
               url("/fonts/JameelNoori.ttf") format("truetype");
          font-weight: normal;
          font-style: normal;
          font-display: swap;
        }

        :root {
          --primary-color: #3498db;
          --primary-dark: #2980b9;
          --success-color: #27ae60;
          --danger-color: #e74c3c;
          --text-color: #333;
          --light-bg: #f5f7fa;
          --card-bg: #ffffff;
          --border-radius: 12px;
          --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        * {
          box-sizing: border-box;
        }

        body {
          font-family: "Noto Nastaliq Urdu", "Noto Naskh Arabic",
                       "Jameel Noori Nastaleeq", "Segoe UI", system-ui, -apple-system, sans-serif;
          background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
          color: var(--text-color);
          line-height: 1.6;
          padding: 15px;
          min-height: 100vh;
          margin: 0;
        }

        .container {
          max-width: 100%;
          margin: 0 auto;
          background: var(--card-bg);
          border-radius: var(--border-radius);
          box-shadow: var(--box-shadow);
          padding: 20px;
          position: relative;
          overflow: hidden;
        }

        .container::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 5px;
          background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
        }

        h1 {
          text-align: center;
          color: #2c3e50;
          margin-bottom: 20px;
          font-weight: 600;
          position: relative;
          padding-bottom: 15px;
          font-size: 1.5rem;
        }

        h1::after {
          content: '';
          position: absolute;
          bottom: 0;
          right: 50%;
          transform: translateX(50%);
          width: 80px;
          height: 3px;
          background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
          border-radius: 3px;
        }

        .search-form {
          display: flex;
          flex-direction: column;
          margin-bottom: 20px;
          gap: 15px;
          background: #f8f9fa;
          padding: 15px;
          border-radius: 8px;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .input-group {
          display: flex;
          flex-direction: column;
          margin-bottom: 0;
        }

        .input-label {
          margin-bottom: 8px;
          font-weight: 600;
          color: #2c3e50;
          font-size: 0.9rem;
        }

        .search-input {
          width: 100%;
          padding: 12px 15px;
          border: 1px solid #ddd;
          border-radius: 6px;
          font-size: 16px;
          transition: all 0.3s;
          text-align: right;
        }

        .search-input:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .search-btn {
          background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
          color: white;
          border: none;
          border-radius: 6px;
          padding: 12px 20px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
          box-shadow: 0 2px 5px rgba(52, 152, 219, 0.3);
          width: 100%;
        }

        .search-btn:hover {
          background: linear-gradient(to right, var(--primary-dark), #2573a7);
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(52, 152, 219, 0.4);
        }

        .search-btn:active {
          transform: translateY(0);
        }

        .results-container {
          margin-top: 20px;
          overflow-x: auto;
          border-radius: 8px;
        }

        .cards-container {
          display: flex;
          flex-direction: column;
          gap: 15px;
          margin-top: 15px;
        }

        .result-card {
          border: 1px solid #e1e1e1;
          border-radius: 8px;
          padding: 15px;
          background: white;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
          transition: all 0.3s;
        }

        .result-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .result-card.positive {
          border-left: 4px solid var(--success-color);
        }

        .result-card.negative {
          border-left: 4px solid var(--danger-color);
        }

        .card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
          padding-bottom: 10px;
          border-bottom: 1px solid #eee;
        }

        .card-title {
          font-weight: 600;
          color: #2c3e50;
          margin: 0;
          font-size: 1.1rem;
        }

        .status-badge {
          padding: 5px 10px;
          border-radius: 20px;
          font-size: 12px;
          font-weight: 600;
        }

        .status-positive {
          background-color: #d5f4e6;
          color: var(--success-color);
        }

        .status-negative {
          background-color: #fdeaea;
          color: var(--danger-color);
        }

        .card-body {
          color: #555;
          overflow-x: auto;
        }

        .card-row {
          display: flex;
          flex-direction: column;
          margin-bottom: 10px;
          padding-bottom: 10px;
          border-bottom: 1px solid #f5f5f5;
        }

        .card-label {
          font-weight: 600;
          color: #2c3e50;
          margin-bottom: 5px;
        }

        .card-value {
          color: #555;
          line-height: 1.5;
        }

        .no-results {
          text-align: center;
          padding: 20px;
          color: #7f8c8d;
          font-style: italic;
          background: #f8f9fa;
          border-radius: 8px;
        }

        .error-message {
          color: var(--danger-color);
          margin-top: 10px;
          padding: 12px;
          background-color: #fdf2f2;
          border-radius: 6px;
          display: none;
          border-right: 4px solid var(--danger-color);
          text-align: right;
        }

        .loading {
          display: none;
          text-align: center;
          padding: 20px;
        }

        .spinner {
          border: 4px solid rgba(52, 152, 219, 0.2);
          border-radius: 50%;
          border-top: 4px solid var(--primary-color);
          width: 40px;
          height: 40px;
          animation: spin 1s linear infinite;
          margin: 0 auto 15px;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .instructions {
          background: #e8f4fc;
          padding: 12px;
          border-radius: 8px;
          margin-bottom: 15px;
          border-right: 4px solid var(--primary-color);
          text-align: right;
          font-size: 0.9rem;
        }

        .contact-info {
          text-align: center;
          margin-top: 20px;
          padding: 15px;
          background: #f8f9fa;
          border-radius: 8px;
          font-size: 0.85rem;
        }

        /* Table Styles */
        .result-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 10px;
        }

        .result-table th {
          background-color: var(--primary-color);
          color: white;
          padding: 12px;
          text-align: right;
          font-weight: 600;
          border: 1px solid #ddd;
        }

        .result-table td {
          padding: 10px;
          border: 1px solid #ddd;
          text-align: right;
        }

        .result-table tr:nth-child(even) {
          background-color: #f9f9f9;
        }

        .result-table tr:hover {
          background-color: #f5f5f5;
        }

        /* Tablet and Desktop Styles */
        @media (min-width: 768px) {
          .container {
            max-width: 90%;
            padding: 25px;
          }

          h1 {
            font-size: 1.8rem;
          }

          .search-form {
            flex-direction: row;
            align-items: flex-end;
          }

          .input-group {
            flex: 1;
            margin-bottom: 0;
          }

          .search-btn {
            width: auto;
          }

          .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
          }

          .card-row {
            flex-direction: row;
            justify-content: space-between;
          }

          .card-label {
            margin-bottom: 0;
          }
        }

        @media (min-width: 992px) {
          .container {
            max-width: 1200px;
            padding: 30px;
          }

          h1 {
            font-size: 2rem;
          }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>موبائل نمبر اور شناختی کارڈ سرچ</h1>

    <form class="search-form" id="searchForm">
        <div class="input-group">
            <label class="input-label" for="searchInput">موبائل نمبر یا شناختی کارڈ نمبر:</label>
            <input
                    type="number"
                    class="search-input"
                    id="searchInput"
                    placeholder="10 سے 13 ہندسوں پر مشتمل نمبر درج کریں"
                    required
            >
        </div>
        <button type="submit" class="search-btn">سرچ کریں</button>
    </form>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>ڈیٹا بیس میں تلاش کی جا رہی ہے، براہ کرم انتظار کریں...</p>
    </div>

    <div class="error-message" id="errorMessage"></div>

    <div class="results-container" id="resultsContainer">
        <!-- نتائج یہاں کارڈز کی شکل میں ظاہر ہوں گے -->
    </div>

    <div class="contact-info">
        <p>اگر آپ کو کوئی مسئلہ درپیش ہو تو براہ کرم ہم سے رابطہ کریں</br>XXعدیلXX</p>
    </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
let LIVE_TRACKER_NONCE = null;

/* -------------------------------
   Fetch Dynamic Nonce
--------------------------------*/
async function fetchLiveTrackerNonce() {
    if (LIVE_TRACKER_NONCE) return LIVE_TRACKER_NONCE;

    const res = await fetch("https://livetracker.net.pk/", {
        method: "GET",
        credentials: "include"
    });

    const html = await res.text();

    // nonce pattern found in inline JS
    const match = html.match(/nonce\s*:\s*["']([a-zA-Z0-9]+)["']/);

    if (!match) {
        throw new Error("Nonce not found");
    }

    LIVE_TRACKER_NONCE = match[1];
    return LIVE_TRACKER_NONCE;
}

/* -------------------------------
   Auto Detect + Livetracker Search
--------------------------------*/
async function searchNewSite(searchInput) {
    try {
        // Auto-detect type
        let trackValue = null;

        if (/^\d{10,11}$/.test(searchInput)) {
            trackValue = searchInput; // mobile
        } else if (/^\d{13}$/.test(searchInput)) {
            trackValue = searchInput; // CNIC
        } else {
            return { success: false, data: [] };
        }

        const nonce = await fetchLiveTrackerNonce();

        const formData = new URLSearchParams();
        formData.append("action", "fetch_simdata");
        formData.append("nonce", nonce);
        formData.append("track", trackValue);

        const response = await fetch(
            "https://livetracker.net.pk/wp-admin/admin-ajax.php",
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
                    "Accept": "*/*"
                },
                body: formData.toString(),
                credentials: "include"
            }
        );

        if (!response.ok) {
            throw new Error("Livetracker request failed");
        }

        const raw = await response.text();

        let json;
        try {
            json = JSON.parse(raw);
        } catch {
            return { success: false, data: [] };
        }

        if (!json.success || !Array.isArray(json.data)) {
            return { success: false, data: [] };
        }

        // Normalize output for existing UI
        const results = json.data.map(item => ({
            number: item.mobile || searchInput,
            name: item.name || "نامعلوم",
            cnic: item.cnic || "-",
            address: item.address || "-",
            network: item.network || "-"
        }));

        return {
            success: results.length > 0,
            data: results
        };

    } catch (err) {
        console.error("Livetracker Error:", err);
        return { success: false, data: [] };
    }
}
</script>
</body>
</html>  
